import type { ActionType, EntityAction } from '@/types/latestActions';

export const mockLatestActions: EntityAction[] = [
  // --- Campaign actions ---
  {
    id: 'la-1',
    entityId: 'camp-1',
    type: 'budget_increase',
    description: 'Daily budget increased',
    details: 'Budget scaled up after 3 consecutive days of ROAS > 3.5x',
    timestamp: '2024-12-11T14:32:00Z',
    performedBy: 'user',
    oldValue: '$200/day',
    newValue: '$250/day',
  },
  {
    id: 'la-2',
    entityId: 'camp-1',
    type: 'ai_optimization',
    description: 'AI bid optimization applied',
    details: 'AI adjusted bidding strategy to maximize conversions within budget',
    timestamp: '2024-12-10T09:15:00Z',
    performedBy: 'ai',
  },
  {
    id: 'la-3',
    entityId: 'camp-2',
    type: 'audience_change',
    description: 'Targeting expanded',
    details: 'Added Canada to location targeting for broader reach',
    timestamp: '2024-12-09T11:20:00Z',
    performedBy: 'user',
    oldValue: 'US only',
    newValue: 'US + Canada',
  },
  {
    id: 'la-4',
    entityId: 'camp-3',
    type: 'budget_increase',
    description: 'Daily budget increased',
    details: 'Scaled budget due to strong lead gen performance',
    timestamp: '2024-12-09T09:45:00Z',
    performedBy: 'user',
    oldValue: '$80/day',
    newValue: '$100/day',
  },
  {
    id: 'la-5',
    entityId: 'camp-4',
    type: 'status_pause',
    description: 'Campaign paused',
    details: 'BFCM promotion period ended, campaign paused manually',
    timestamp: '2024-12-09T18:30:00Z',
    performedBy: 'user',
    oldValue: 'Active',
    newValue: 'Paused',
  },
  {
    id: 'la-6',
    entityId: 'camp-4',
    type: 'budget_decrease',
    description: 'Lifetime budget reduced',
    details: 'Reduced remaining lifetime budget as campaign winds down',
    timestamp: '2024-12-08T16:00:00Z',
    performedBy: 'user',
    oldValue: '$15,000',
    newValue: '$12,000',
  },
  {
    id: 'la-7',
    entityId: 'camp-5',
    type: 'status_enable',
    description: 'Campaign enabled',
    details: 'Re-enabled evergreen retargeting after creative refresh',
    timestamp: '2024-12-10T16:20:00Z',
    performedBy: 'user',
    oldValue: 'Paused',
    newValue: 'Active',
  },
  {
    id: 'la-8',
    entityId: 'camp-7',
    type: 'budget_increase',
    description: 'Budget increased by AI',
    details: 'AI Optimizer detected high CTR and increased budget',
    timestamp: '2024-12-07T20:30:00Z',
    performedBy: 'ai',
    oldValue: '$25/day',
    newValue: '$30/day',
  },
  {
    id: 'la-9',
    entityId: 'camp-8',
    type: 'status_pause',
    description: 'Campaign paused',
    details: 'Paused due to low ROAS of 0.40x over the last 7 days',
    timestamp: '2024-12-06T09:00:00Z',
    performedBy: 'user',
    oldValue: 'Active',
    newValue: 'Paused',
  },

  // --- Ad set actions ---
  {
    id: 'la-10',
    entityId: 'adset-1-1',
    type: 'budget_increase',
    description: 'Budget increased by AI',
    details: 'AI Optimizer scaled budget based on strong conversion rate',
    timestamp: '2024-12-11T10:15:00Z',
    performedBy: 'ai',
    oldValue: '$100/day',
    newValue: '$120/day',
  },
  {
    id: 'la-11',
    entityId: 'adset-1-1',
    type: 'ai_optimization',
    description: 'Audience optimization',
    details: 'AI narrowed age range from 25-45 to 28-42 based on converter profile',
    timestamp: '2024-12-10T03:00:00Z',
    performedBy: 'ai',
    oldValue: '25-45',
    newValue: '28-42',
  },
  {
    id: 'la-12',
    entityId: 'adset-1-2',
    type: 'budget_decrease',
    description: 'Budget reduced by rule',
    details: 'Budget Guard rule triggered — spend pacing too fast for the day',
    timestamp: '2024-12-05T17:45:00Z',
    performedBy: 'rule',
    oldValue: '$100/day',
    newValue: '$80/day',
  },
  {
    id: 'la-13',
    entityId: 'adset-1-3',
    type: 'schedule_change',
    description: 'Delivery schedule updated',
    details: 'Changed from all-day delivery to peak hours only (10am-10pm)',
    timestamp: '2024-12-08T14:30:00Z',
    performedBy: 'user',
    oldValue: 'All day',
    newValue: '10am-10pm',
  },
  {
    id: 'la-14',
    entityId: 'adset-2-1',
    type: 'audience_change',
    description: 'Interest targeting updated',
    details: 'Added Fitness interest to expand audience pool',
    timestamp: '2024-12-08T15:00:00Z',
    performedBy: 'user',
    oldValue: 'Wellness, Health',
    newValue: 'Wellness, Health, Fitness',
  },
  {
    id: 'la-15',
    entityId: 'adset-3-1',
    type: 'bid_change',
    description: 'Bid cap adjusted',
    details: 'Increased bid cap to compete for higher-quality leads',
    timestamp: '2024-12-07T08:30:00Z',
    performedBy: 'user',
    oldValue: '$2.50',
    newValue: '$3.00',
  },
  {
    id: 'la-16',
    entityId: 'adset-3-2',
    type: 'status_pause',
    description: 'Paused by automation rule',
    details: 'Stop Loss rule triggered — CPA exceeded $5.00 threshold',
    timestamp: '2024-12-10T22:45:00Z',
    performedBy: 'rule',
    oldValue: 'Active',
    newValue: 'Paused',
  },
  {
    id: 'la-17',
    entityId: 'adset-4-1',
    type: 'budget_increase',
    description: 'Scaled by automation rule',
    details: 'Scale Up rule triggered — ROAS above 4.0x for 3 consecutive days',
    timestamp: '2024-12-07T14:00:00Z',
    performedBy: 'rule',
    oldValue: '$250/day',
    newValue: '$300/day',
  },
  {
    id: 'la-18',
    entityId: 'adset-4-2',
    type: 'duplicate',
    description: 'Ad set duplicated',
    details: 'Duplicated to test new audience segment with same creatives',
    timestamp: '2024-12-06T10:45:00Z',
    performedBy: 'user',
  },
  {
    id: 'la-19',
    entityId: 'adset-5-1',
    type: 'bid_change',
    description: 'Bid adjusted by AI',
    details: 'AI Bidding increased bid to capture more retargeting impressions',
    timestamp: '2024-12-09T12:10:00Z',
    performedBy: 'ai',
    oldValue: '$0.85',
    newValue: '$0.92',
  },
  {
    id: 'la-20',
    entityId: 'adset-5-2',
    type: 'ai_optimization',
    description: 'Placement optimization',
    details: 'AI disabled underperforming Audience Network placement',
    timestamp: '2024-12-08T04:00:00Z',
    performedBy: 'ai',
    oldValue: 'All placements',
    newValue: 'Feed + Stories only',
  },
  {
    id: 'la-21',
    entityId: 'adset-6-1',
    type: 'schedule_change',
    description: 'Start time adjusted',
    details: 'Enabled by Schedule Rule at start of business hours',
    timestamp: '2024-12-08T06:00:00Z',
    performedBy: 'rule',
    oldValue: 'Paused',
    newValue: 'Active',
  },
  {
    id: 'la-22',
    entityId: 'adset-7-1',
    type: 'audience_change',
    description: 'Age range narrowed',
    details: 'Narrowed age range based on engagement data analysis',
    timestamp: '2024-12-06T13:15:00Z',
    performedBy: 'user',
    oldValue: '18-55',
    newValue: '22-50',
  },
  {
    id: 'la-23',
    entityId: 'adset-8-1',
    type: 'status_pause',
    description: 'Ad set paused',
    details: 'Paused along with parent campaign due to low engagement ROI',
    timestamp: '2024-12-06T09:05:00Z',
    performedBy: 'user',
    oldValue: 'Active',
    newValue: 'Paused',
  },

  // --- Ad-level actions ---
  {
    id: 'la-24',
    entityId: 'ad-1-1-1',
    type: 'creative_update',
    description: 'Creative refreshed',
    details: 'Updated lifestyle image with new summer beach photography',
    timestamp: '2024-12-10T11:00:00Z',
    performedBy: 'user',
    oldValue: 'Beach Glow v1',
    newValue: 'Beach Glow v2',
  },
  {
    id: 'la-25',
    entityId: 'ad-1-1-2',
    type: 'creative_update',
    description: 'Creative swapped by rule',
    details: 'Fatigue Rule triggered — ad frequency exceeded 3.0 threshold',
    timestamp: '2024-12-10T08:00:00Z',
    performedBy: 'rule',
    oldValue: 'Video V1',
    newValue: 'Video V2',
  },
  {
    id: 'la-26',
    entityId: 'ad-1-1-2',
    type: 'ai_optimization',
    description: 'Copy optimized by AI',
    details: 'AI rewrote headline for higher predicted CTR',
    timestamp: '2024-12-09T05:30:00Z',
    performedBy: 'ai',
    oldValue: 'See Why Women Love This',
    newValue: 'See Why 10,000+ Women Love This',
  },
  {
    id: 'la-27',
    entityId: 'ad-1-2-1',
    type: 'duplicate',
    description: 'Ad duplicated',
    details: 'Duplicated carousel ad to test with different headline variations',
    timestamp: '2024-12-07T16:20:00Z',
    performedBy: 'user',
  },
  {
    id: 'la-28',
    entityId: 'ad-1-2-2',
    type: 'status_pause',
    description: 'Ad paused',
    details: 'Paused underperforming before/after ad — ROAS below target',
    timestamp: '2024-12-08T10:30:00Z',
    performedBy: 'user',
    oldValue: 'Active',
    newValue: 'Paused',
  },
  {
    id: 'la-29',
    entityId: 'ad-2-1-1',
    type: 'creative_update',
    description: 'Video thumbnail updated',
    details: 'Replaced auto-generated thumbnail with custom-designed frame',
    timestamp: '2024-12-07T14:45:00Z',
    performedBy: 'user',
    oldValue: 'Auto thumbnail',
    newValue: 'Custom thumbnail',
  },
  {
    id: 'la-30',
    entityId: 'ad-2-1-2',
    type: 'ai_optimization',
    description: 'CTA optimized by AI',
    details: 'AI changed CTA from Learn More to Shop Now based on conversion data',
    timestamp: '2024-12-06T22:00:00Z',
    performedBy: 'ai',
    oldValue: 'Learn More',
    newValue: 'Shop Now',
  },
  {
    id: 'la-31',
    entityId: 'ad-3-1-1',
    type: 'bid_change',
    description: 'Bid adjusted by AI Bidding',
    details: 'AI Bidding optimized bid for leads during peak conversion hours',
    timestamp: '2024-12-06T11:20:00Z',
    performedBy: 'ai',
    oldValue: '$2.80',
    newValue: '$3.00',
  },
  {
    id: 'la-32',
    entityId: 'ad-3-2-1',
    type: 'status_pause',
    description: 'Ad paused by rule',
    details: 'Paused when parent ad set was paused by Stop Loss rule',
    timestamp: '2024-12-10T22:46:00Z',
    performedBy: 'rule',
    oldValue: 'Active',
    newValue: 'Paused',
  },
  {
    id: 'la-33',
    entityId: 'ad-4-1-1',
    type: 'creative_update',
    description: 'Countdown timer updated',
    details: 'Updated countdown timer creative for final 24 hours of sale',
    timestamp: '2024-12-01T00:00:00Z',
    performedBy: 'user',
    oldValue: '48h countdown',
    newValue: '24h countdown',
  },
  {
    id: 'la-34',
    entityId: 'ad-4-1-2',
    type: 'duplicate',
    description: 'Ad duplicated for testing',
    details: 'Duplicated to test gift bundle with different price point headline',
    timestamp: '2024-11-28T08:00:00Z',
    performedBy: 'user',
  },
  {
    id: 'la-35',
    entityId: 'ad-4-2-1',
    type: 'ai_optimization',
    description: 'Delivery optimized by AI',
    details: 'AI shifted delivery to past purchasers with highest predicted LTV',
    timestamp: '2024-11-30T02:00:00Z',
    performedBy: 'ai',
  },
  {
    id: 'la-36',
    entityId: 'ad-5-1-1',
    type: 'creative_update',
    description: 'Social proof numbers updated',
    details: 'Updated customer count from 10,000+ to 12,000+ in headline',
    timestamp: '2024-12-05T09:00:00Z',
    performedBy: 'user',
    oldValue: '10,000+ Customers',
    newValue: '12,000+ Customers',
  },
  {
    id: 'la-37',
    entityId: 'ad-5-2-1',
    type: 'schedule_change',
    description: 'Ad delivery scheduled',
    details: 'Set to deliver only during evening hours for cart recovery',
    timestamp: '2024-12-04T15:30:00Z',
    performedBy: 'user',
    oldValue: 'All day',
    newValue: '6pm-12am',
  },
  {
    id: 'la-38',
    entityId: 'ad-6-1-1',
    type: 'status_enable',
    description: 'Ad enabled by rule',
    details: 'Schedule Rule enabled ad at start of business hours',
    timestamp: '2024-12-08T06:01:00Z',
    performedBy: 'rule',
    oldValue: 'Paused',
    newValue: 'Active',
  },
  {
    id: 'la-39',
    entityId: 'ad-7-1-1',
    type: 'creative_update',
    description: 'Blog post link updated',
    details: 'Updated destination URL to new blog post revision',
    timestamp: '2024-12-05T12:00:00Z',
    performedBy: 'user',
    oldValue: '/blog/top-5-v1',
    newValue: '/blog/top-5-v2',
  },
  {
    id: 'la-40',
    entityId: 'ad-8-1-1',
    type: 'status_pause',
    description: 'Ad paused',
    details: 'Paused with parent campaign — engagement campaign ended',
    timestamp: '2024-12-06T09:02:00Z',
    performedBy: 'user',
    oldValue: 'Active',
    newValue: 'Paused',
  },
  {
    id: 'la-41',
    entityId: 'camp-6',
    type: 'ai_optimization',
    description: 'Video delivery optimized',
    details: 'AI optimized delivery for ThruPlay completions over impressions',
    timestamp: '2024-12-07T03:00:00Z',
    performedBy: 'ai',
  },
  {
    id: 'la-42',
    entityId: 'ad-1-3-1',
    type: 'ai_optimization',
    description: 'Dynamic product set refreshed',
    details: 'AI refreshed product catalog feed with top-selling items',
    timestamp: '2024-12-09T01:00:00Z',
    performedBy: 'ai',
  },
  {
    id: 'la-43',
    entityId: 'camp-5',
    type: 'ai_optimization',
    description: 'Campaign-level bid tuning',
    details: 'AI rebalanced budget allocation across ad sets for optimal ROAS',
    timestamp: '2024-12-09T04:00:00Z',
    performedBy: 'ai',
  },
];

export function getActionsForEntity(entityId: string): EntityAction[] {
  // Check for pre-defined mock actions first
  const existingActions = mockLatestActions
    .filter((action) => action.entityId === entityId)
    .sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime());

  if (existingActions.length > 0) {
    return existingActions;
  }

  // For real entity IDs (e.g. Facebook numeric IDs), generate deterministic placeholder actions
  return generateActionsForEntity(entityId);
}

function simpleHash(str: string): number {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    const char = str.charCodeAt(i);
    hash = ((hash << 5) - hash) + char;
    hash = hash & hash;
  }
  return Math.abs(hash);
}

function generateActionsForEntity(entityId: string): EntityAction[] {
  const hash = simpleHash(entityId);
  const numActions = hash % 3; // 0 to 2 actions

  if (numActions === 0) return [];

  const possibleTypes: ActionType[] = [
    'budget_increase', 'budget_decrease', 'status_pause', 'status_enable',
    'bid_change', 'creative_update', 'ai_optimization', 'audience_change',
  ];

  const performers: Array<'user' | 'ai' | 'rule'> = ['user', 'ai', 'rule'];
  const actions: EntityAction[] = [];

  for (let i = 0; i < numActions; i++) {
    const typeIdx = (hash + i * 7) % possibleTypes.length;
    const actionType = possibleTypes[typeIdx];
    const performer = performers[(hash + i * 3) % performers.length];
    const hoursAgo = ((hash + i * 13) % 11) + 1; // 1-11 hours ago
    const timestamp = new Date(Date.now() - hoursAgo * 3600000).toISOString();

    const actionDescriptions: Record<ActionType, { desc: string; details: string; oldVal?: string; newVal?: string }> = {
      budget_increase: { desc: 'Daily budget increased', details: 'Budget scaled based on performance', oldVal: `$${50 + (hash % 200)}/day`, newVal: `$${70 + (hash % 250)}/day` },
      budget_decrease: { desc: 'Daily budget decreased', details: 'Budget reduced to optimize spend efficiency', oldVal: `$${80 + (hash % 200)}/day`, newVal: `$${50 + (hash % 150)}/day` },
      status_pause: { desc: 'Paused', details: 'Paused based on performance threshold', oldVal: 'Active', newVal: 'Paused' },
      status_enable: { desc: 'Enabled', details: 'Re-enabled after optimization', oldVal: 'Paused', newVal: 'Active' },
      bid_change: { desc: 'Bid adjusted', details: 'Bid updated for better auction positioning', oldVal: `$${(1 + (hash % 40) / 10).toFixed(2)}`, newVal: `$${(1.5 + (hash % 40) / 10).toFixed(2)}` },
      creative_update: { desc: 'Creative refreshed', details: 'Creative updated with new assets', oldVal: 'Version A', newVal: 'Version B' },
      ai_optimization: { desc: 'AI optimization applied', details: 'AI adjusted settings for better performance' },
      audience_change: { desc: 'Audience updated', details: 'Targeting parameters adjusted', oldVal: 'Broad', newVal: 'Refined' },
      duplicate: { desc: 'Duplicated', details: 'Entity duplicated for testing' },
      schedule_change: { desc: 'Schedule updated', details: 'Delivery schedule adjusted' },
    };

    const actionInfo = actionDescriptions[actionType];
    actions.push({
      id: `gen-${entityId}-${i}`,
      entityId,
      type: actionType,
      description: actionInfo.desc,
      details: actionInfo.details,
      timestamp,
      performedBy: performer,
      oldValue: actionInfo.oldVal,
      newValue: actionInfo.newVal,
    });
  }

  return actions.sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime());
}
